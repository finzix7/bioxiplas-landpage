---
import CallToAction from "@/components/sections/CallToAction.astro";
import Base from "@/layouts/Base.astro";
import SinglePageLayout from "@/components/SinglePageLayout.astro";
import { fetchBlogBySlug } from "@/lib/payload";
import { useTranslations } from "@/lib/utils/languageParser.ts";
import { markdownify } from "@/lib/utils/textConverter";

export const prerender = false;

const { single } = Astro.params;

const blog = await fetchBlogBySlug(single!, Astro.currentLocale);
const translations = await useTranslations(Astro.currentLocale as string);

let contentHtml = "";
if (blog?.content) {
  contentHtml = markdownify(blog.content, true) as string;
}
---
<Base {...(blog || {})}>
  <SinglePageLayout
    layout="modern"
    translations={translations}
    content={{
      ...blog,
      Content: contentHtml,
    }}
  />
  <CallToAction />
</Base>
