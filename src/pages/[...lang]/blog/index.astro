---
import Base from "@/layouts/Base.astro";
import CallToAction from "@/components/sections/CallToAction.astro";
import BlogCard from "@/layouts/components/cards/BlogCard.astro";
import { fetchAllBlogs } from "@/lib/payload";
import { generatePaths } from "@/lib/utils/languageParser.ts";

export function getStaticPaths() {
  return generatePaths();
}

const response = await fetchAllBlogs(Astro.currentLocale as string);
let posts = response?.docs || [];
posts = posts.sort((a: any, b: any) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());
---
<Base title="Blog" fitToScreen={false}>
  <section class="relative overflow-hidden">
    <div class="container">
      <div class="grid gap-x-6 gap-y-10 md:grid-cols-2 xl:grid-cols-3">
        {posts.map((post: any, index: number) => (
          <BlogCard
            content={{ ...post, slug: post.slug, collection: 'blog' }}
            data-aos="fade-up-sm"
            data-aos-delay={((index % 3) + 1) * 100}
          />
        ))}
      </div>
    </div>
  </section>
  <CallToAction />
</Base>
