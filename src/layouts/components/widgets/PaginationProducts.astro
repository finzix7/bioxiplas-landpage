---
import {
  getLocaleUrlCTM,
  useTranslations,
} from "@/lib/utils/languageParser.ts";

interface Props {
  currentPage?: number;
  totalPages?: number;
  class?: string;
}

const {
  currentPage = 1,
  totalPages = 1,
  class: className,
} = Astro.props;

const indexPageLink = currentPage === 2;
const hasPrevPage = currentPage > 1;
const hasNextPage = totalPages > currentPage!;
const t = await useTranslations(Astro.currentLocale as string);

// ⚠️ Forzamos el base path a /products
const base = "/products";

let pageList: number[] = [];
for (let i = 1; i <= totalPages; i++) {
  pageList.push(i);
}
---

{totalPages > 1 && (
  <nav
    id="pagination"
    class:list={[
      "flex flex-wrap items-center justify-center gap-3 font-normal",
      className,
    ]}
    aria-label="Pagination">
    
    <!-- Prev -->
    {hasPrevPage ? (
      <a
        href={getLocaleUrlCTM(
          indexPageLink
            ? base
            : `${base}/page/${currentPage - 1}`,
          Astro.currentLocale,
        )}
        class="hover:bg-primary text-text-default hover:text-light flex items-center gap-3 rounded-full border px-8 py-2.5 text-lg transition duration-300">
        <svg width="23" height="14" viewBox="0 0 23 14" fill="none"><path d="M7.9 0.7C7.9 1.38 7.25 2.38 6.58 3.21C5.73 4.29 4.7 5.23 3.53 5.95C2.65 6.48 1.59 7 0.73 7M0.73 7C1.59 7 2.66 7.52 3.53 8.05C4.7 8.77 5.73 9.71 6.58 10.79C7.25 11.62 7.91 12.62 7.91 13.28M0.73 7L22.27 7" stroke="currentColor" stroke-width="0.9"/></svg>
        {t("common.pagination_previous")}
      </a>
    ) : (
      <span class="text-light/25 pointer-events-none flex cursor-not-allowed items-center gap-3 rounded-full border px-8 py-2.5 text-lg transition duration-300 select-none">
        <svg width="23" height="14" viewBox="0 0 23 14" fill="none"><path d="M7.9 0.7C7.9 1.38 7.25 2.38 6.58 3.21C5.73 4.29 4.7 5.23 3.53 5.95C2.65 6.48 1.59 7 0.73 7M0.73 7C1.59 7 2.66 7.52 3.53 8.05C4.7 8.77 5.73 9.71 6.58 10.79C7.25 11.62 7.91 12.62 7.91 13.28M0.73 7L22.27 7" stroke="currentColor" stroke-width="0.9"/></svg>
        {t("common.pagination_previous")}
      </span>
    )}

    <!-- Pages -->
    {pageList.map((pagination, i) =>
      pagination === currentPage ? (
        <span
          aria-current="page"
          class="text-light bg-primary flex h-12 w-12 items-center justify-center rounded-full border text-lg">
          {pagination}
        </span>
      ) : (
        <a
          href={getLocaleUrlCTM(
            i === 0 ? base : `${base}/page/${pagination}`,
            Astro.currentLocale,
          )}
          aria-current="page"
          class="text-text-default hover:bg-primary hover:text-light flex h-12 w-12 items-center justify-center rounded-full border text-lg transition duration-300">
          {pagination}
        </a>
      )
    )}

    <!-- Next -->
    {hasNextPage ? (
      <a
        href={getLocaleUrlCTM(
          `${base}/page/${currentPage + 1}`,
          Astro.currentLocale,
        )}
        class="hover:bg-primary text-text-default hover:text-light flex items-center gap-3 rounded-full border px-8 py-2.5 text-lg transition duration-300">
        {t("common.pagination_next")}
        <svg width="22" height="16" viewBox="0 0 22 16" fill="none"><path d="M14.6 1.7C14.6 2.38 15.25 3.38 15.91 4.21C16.77 5.29 17.79 6.23 18.97 6.95C19.84 7.48 20.91 8 21.77 8M21.77 8C20.91 8 19.84 8.52 18.97 9.05C17.79 9.77 16.77 10.71 15.91 11.79C15.25 12.62 14.59 13.62 14.59 14.28M21.77 8L0.23 8" stroke="currentColor" stroke-width="0.9"/></svg>
      </a>
    ) : (
      <span class="text-light/25 pointer-events-none flex cursor-not-allowed items-center gap-3 rounded-full border px-8 py-2.5 text-lg transition duration-300 select-none">
        {t("common.pagination_next")}
        <svg width="22" height="16" viewBox="0 0 22 16" fill="none"><path d="M14.6 1.7C14.6 2.38 15.25 3.38 15.91 4.21C16.77 5.29 17.79 6.23 18.97 6.95C19.84 7.48 20.91 8 21.77 8M21.77 8C20.91 8 19.84 8.52 18.97 9.05C17.79 9.77 16.77 10.71 15.91 11.79C15.25 12.62 14.59 13.62 14.59 14.28M21.77 8L0.23 8" stroke="currentColor" stroke-width="0.9"/></svg>
      </span>
    )}
  </nav>
)}
