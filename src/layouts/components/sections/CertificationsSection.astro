---
import { fetchCertifications } from "@/lib/payload";
import parseTomlToJson from "@/lib/utils/parseTomlToJson";
import { markdownify } from "@/lib/utils/textConverter";
import CertificationCard from "../cards/CertificationCard.astro";
import Pagination from "../widgets/Pagination.astro";
import Subtitle from "../widgets/Subtitle.astro";

interface Props {
  content?: {
    enable?: boolean;
    title?: string;
    subtitle?: string;
  };
  pagination: {
    enable: boolean;
    currentPage: number;
  };
}

const config = parseTomlToJson("./src/config/config.toml");
const limit = config.settings.pagination;

const { content = {}, pagination } = Astro.props as Props;
const { enable = true, title, subtitle } = content;
const currentPage = pagination?.currentPage || 1;

const certResponse = await fetchCertifications({
  page: currentPage,
  limit,
  locale: Astro.currentLocale,
});

const certifications = certResponse?.docs || [];
const totalPages = certResponse?.totalPages || 1;
---
{enable && (
  <section class="relative overflow-hidden">
    <div class="container">
      <div class="mx-auto max-w-2xl text-center" data-aos="fade-up-sm">
        <Subtitle content={subtitle} />
        {title && (
          <h2 class="h2 has-italic-text capitalize" set:html={markdownify(title)} />
        )}
      </div>
      <div
        class="md:bg-primary/10 mt-12 space-y-16 rounded-lg md:mt-16 md:p-16"
        data-aos="fade-up-sm"
        data-aos-delay="200">
        <div class="grid gap-x-6 gap-y-10 md:grid-cols-2 xl:grid-cols-3">
          {certifications.map((cert, index) => (
            <CertificationCard
              content={{ ...cert, slug: cert.slug || cert.id, collection: 'certifications' }}
              data-aos="fade-up-sm"
              data-aos-delay={((index % 3) + 1) * 100}
            />
          ))}
        </div>
        {pagination?.enable && (
          <Pagination
            collection="certifications"
            currentPage={currentPage}
            totalPages={totalPages}
          />
        )}
      </div>
    </div>
  </section>
)}
